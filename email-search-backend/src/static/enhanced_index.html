<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Intelligence System - –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .search-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .search-form {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .search-input {
            flex: 1;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .search-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .search-btn:hover {
            transform: translateY(-2px);
        }

        .search-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .search-options {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e1e5e9;
        }

        .search-options h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.1rem;
        }

        .search-method-options {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .search-method-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .search-method-option input[type="radio"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .search-method-option label {
            cursor: pointer;
            font-size: 14px;
            color: #555;
            font-weight: 500;
        }

        .search-method-description {
            font-size: 12px;
            color: #777;
            margin-top: 5px;
        }

        .results-container {
            display: block;
        }

        .results-tabs {
            display: flex;
            background: white;
            border-radius: 15px 15px 0 0;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .tab-btn {
            flex: 1;
            padding: 15px 20px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab-btn.active {
            background: white;
            border-bottom-color: #667eea;
            color: #667eea;
        }

        .tab-content {
            background: white;
            border-radius: 0 0 15px 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è */
        .basic-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .info-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .info-card h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .info-card p {
            color: #666;
            line-height: 1.5;
        }

        /* –ê–Ω–∞–ª–∏–∑ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü */
        .webpage-analysis {
            margin-top: 30px;
        }

        .analysis-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
        }

        .analysis-header h2 {
            font-size: 1.5rem;
        }

        .confidence-score {
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .analysis-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e1e5e9;
        }

        .analysis-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-icon {
            width: 24px;
            height: 24px;
            background: #667eea;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
        }

        .extracted-data {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .data-item {
            padding: 8px 12px;
            background: #e3f2fd;
            border-radius: 20px;
            display: inline-block;
            margin: 4px;
            font-size: 14px;
            color: #1976d2;
        }

        .url-analysis {
            margin-top: 20px;
        }

        .url-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #4caf50;
        }

        .url-item.failed {
            border-left-color: #f44336;
        }

        .url-item .url {
            font-weight: 600;
            color: #1976d2;
            text-decoration: none;
            display: block;
            margin-bottom: 5px;
        }

        .url-item .status {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 12px;
            display: inline-block;
        }

        .status.success {
            background: #e8f5e8;
            color: #2e7d2e;
        }

        .status.failed {
            background: #ffebee;
            color: #c62828;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #f44336;
        }

        .success-message {
            background: #e8f5e8;
            color: #2e7d2e;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #4caf50;
        }

        /* –ü—É–±–ª–∏–∫–∞—Ü–∏–∏ */
        .publication-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .publication-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .publication-details {
            color: #666;
            font-size: 14px;
            line-height: 1.5;
        }

        /* –í—ã–≤–æ–¥—ã */
        .conclusions {
            background: #f0f8ff;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .conclusion-item {
            margin-bottom: 10px;
            padding: 10px 0;
            border-bottom: 1px solid #e1e5e9;
        }

        .conclusion-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        /* –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ */
        .saved-entry {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .saved-entry:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .saved-entry h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .saved-entry p {
            color: #666;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .saved-entry button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 10px;
            margin-right: 10px;
        }

        .saved-entry button:hover {
            transform: translateY(-1px);
        }

        .saved-entry .delete-btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .saved-entry .delete-btn:hover {
            background: linear-gradient(135deg, #c0392b 0%, #a93226 100%);
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .search-form {
                flex-direction: column;
            }

            .results-tabs {
                flex-direction: column;
            }

            .analysis-grid {
                grid-template-columns: 1fr;
            }

            .basic-info {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìß Email Intelligence System</h1>
            <p>–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ email –∞–¥—Ä–µ—Å–æ–≤ —Å –∏–∑—É—á–µ–Ω–∏–µ–º –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü</p>
        </div>

        <div class="search-section">
            <div class="search-form">
                <input type="email" class="search-input" id="emailInput" placeholder="–í–≤–µ–¥–∏—Ç–µ email –∞–¥—Ä–µ—Å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞..." required>
                <button class="search-btn" id="searchBtn" onclick="searchEmail()">üîç –ê–Ω–∞–ª–∏–∑</button>
            </div>
            
            <div class="search-options">
                <h3>üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–∏—Å–∫–∞</h3>
                <div class="search-method-options">
                    <div class="search-method-option">
                        <input type="radio" id="searchAuto" name="searchMethod" value="auto" checked>
                        <label for="searchAuto">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä</label>
                    </div>
                    <div class="search-method-option">
                        <input type="radio" id="searchGoogleAPI" name="searchMethod" value="google_api">
                        <label for="searchGoogleAPI">Google Search API</label>
                    </div>
                    <div class="search-method-option">
                        <input type="radio" id="searchBrowser" name="searchMethod" value="browser_search">
                        <label for="searchBrowser">–ë—Ä–∞—É–∑–µ—Ä–Ω—ã–π –ø–æ–∏—Å–∫</label>
                    </div>
                </div>
                <div class="search-method-description">
                    <span id="methodDescription">–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–µ—Ä–µ—Ç –ª—É—á—à–∏–π –¥–æ—Å—Ç—É–ø–Ω—ã–π –º–µ—Ç–æ–¥ –ø–æ–∏—Å–∫–∞</span>
                </div>
            </div>
            <div class="cache-management" style="margin-top: 15px; text-align: center;">
                <button class="search-btn" onclick="clearCache()" style="margin: 5px; background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à</button>
            </div>
        </div>

        <!-- –†–∞–∑–¥–µ–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞ -->
        <div class="results-section">
            <div class="results-container" id="resultsContainer">
                <div class="results-tabs">
                    <button class="tab-btn active" onclick="showTab('basic')">üìã –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</button>
                    <button class="tab-btn" onclick="showTab('webpage')">üîç –ê–Ω–∞–ª–∏–∑ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü</button>
                    <button class="tab-btn" onclick="showTab('publications')">üìö –ü—É–±–ª–∏–∫–∞—Ü–∏–∏</button>
                    <button class="tab-btn" onclick="showTab('timeline')">‚è∞ –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞</button>
                    <button class="tab-btn" onclick="showTab('networks')">üåê –°–µ—Ç–∏ –∏ —Å–≤—è–∑–∏</button>
                    <button class="tab-btn" onclick="showTab('saved')">üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
                    <button class="tab-btn" onclick="showTab('conclusions')">üí° –í—ã–≤–æ–¥—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
                </div>

                <div class="tab-content active" id="basicTab">
                    <div class="basic-info" id="basicInfo">
                        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∑–¥–µ—Å—å -->
                    </div>
                </div>

                <div class="tab-content" id="webpageTab">
                    <div class="webpage-analysis" id="webpageAnalysis">
                        <!-- –ê–Ω–∞–ª–∏–∑ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –∑–¥–µ—Å—å -->
                    </div>
                </div>

                <div class="tab-content" id="publicationsTab">
                    <div id="publicationsContent">
                        <!-- –ü—É–±–ª–∏–∫–∞—Ü–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
                    </div>
                </div>

                <div class="tab-content" id="savedTab">
                    <div id="savedDataContent">
                        <!-- –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
                    </div>
                </div>

                <div class="tab-content" id="timelineTab">
                    <div id="timelineContent">
                        <!-- –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∑–¥–µ—Å—å -->
                    </div>
                </div>

                <div class="tab-content" id="networksTab">
                    <div id="networksContent">
                        <!-- –°–µ—Ç–∏ –∏ —Å–≤—è–∑–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
                    </div>
                </div>

                <div class="tab-content" id="conclusionsTab">
                    <div class="conclusions" id="conclusionsContent">
                        <!-- –í—ã–≤–æ–¥—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentData = null;

        function showTab(tabName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.getElementById(tabName + 'Tab').classList.add('active');
            event.target.classList.add('active');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏
            if (tabName === 'saved') {
                loadSavedData();
            }
        }

        async function clearCache() {
            try {
                const response = await fetch('/api/cache/clear', {
                    method: 'POST'
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                alert(`–ö—ç—à –æ—á–∏—â–µ–Ω: ${result.message}`);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞:', error);
                alert('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞: ' + error.message);
            }
        }


        async function searchEmail() {
            const emailInput = document.getElementById('emailInput');
            const searchBtn = document.getElementById('searchBtn');
            const resultsContainer = document.getElementById('resultsContainer');

            const email = emailInput.value.trim();
            if (!email) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ email –∞–¥—Ä–µ—Å');
                return;
            }

            // –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –ø–æ–∏—Å–∫–∞
            const selectedMethod = document.querySelector('input[name="searchMethod"]:checked').value;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ —ç—Ç–æ—Ç email —É–∂–µ –Ω–∞–π–¥–µ–Ω —Ä–∞–Ω–µ–µ
            const forceRefresh = await checkIfEmailSearchedBefore(email);
            
            const endpoint = '/api/email/search';
            const loadingText = '‚è≥ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º...';
            const originalText = 'üîç –ê–Ω–∞–ª–∏–∑';

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏
            searchBtn.disabled = true;
            searchBtn.innerHTML = loadingText;
            resultsContainer.style.display = 'block';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –Ω–∞ –≤—Å–µ—Ö –≤–∫–ª–∞–¥–∫–∞—Ö
            showLoading();

            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        email: email,
                        search_method: selectedMethod,
                        force_refresh: forceRefresh
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                currentData = data;

                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                displayResults(data);

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showError('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø–æ–∏—Å–∫–∞: ' + error.message);
            } finally {
                searchBtn.disabled = false;
                searchBtn.innerHTML = originalText;
            }
        }

        async function checkIfEmailSearchedBefore(email) {
            try {
                const response = await fetch('/api/email/history?page=1&limit=100');
                if (response.ok) {
                    const data = await response.json();
                    return data.results.some(entry => entry.email === email);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏:', error);
            }
            return false;
        }

        function showLoading() {
            const loadingHtml = '<div class="loading">–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞ –ø–æ–¥–æ–∂–¥–∏—Ç–µ...</div>';
            
            document.getElementById('basicInfo').innerHTML = loadingHtml;
            document.getElementById('webpageAnalysis').innerHTML = loadingHtml;
            document.getElementById('publicationsContent').innerHTML = loadingHtml;
            document.getElementById('timelineContent').innerHTML = loadingHtml;
            document.getElementById('networksContent').innerHTML = loadingHtml;
            document.getElementById('conclusionsContent').innerHTML = loadingHtml;
        }

        function showError(message) {
            const errorHtml = `<div class="error-message">${message}</div>`;
            
            document.getElementById('basicInfo').innerHTML = errorHtml;
            document.getElementById('webpageAnalysis').innerHTML = errorHtml;
            document.getElementById('publicationsContent').innerHTML = errorHtml;
            document.getElementById('timelineContent').innerHTML = errorHtml;
            document.getElementById('networksContent').innerHTML = errorHtml;
            document.getElementById('conclusionsContent').innerHTML = errorHtml;
        }

        function displayResults(data) {
            displayBasicInfo(data);
            displayWebpageAnalysis(data);
            displayPublications(data);
            displayTimeline(data);
            displayNetworks(data);
            displayConclusions(data);
        }

        async function loadSavedData() {
            const savedDataContainer = document.getElementById('savedDataContent');
            savedDataContainer.innerHTML = '–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö...';

            try {
                const response = await fetch('/api/email/history?page=1&limit=10');
                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ HTTP: ${response.status}`);
                }

                const data = await response.json();
                renderSavedData(data.results);
                savedDataContainer.dataset.loaded = 'true';

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:', error);
                savedDataContainer.innerHTML = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.';
            }
        }

        function renderSavedData(results) {
            const savedDataContainer = document.getElementById('savedDataContent');
            if (results.length === 0) {
                savedDataContainer.innerHTML = '–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.';
                return;
            }

            const html = results.map((entry, index) => `
                <div class="saved-entry">
                    <h3>${entry.email}</h3>
                    <p>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: ${new Date(entry.created_at).toLocaleString()}</p>
                    <p>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${new Date(entry.updated_at).toLocaleString()}</p>
                    <p>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞—â–µ–Ω–∏–π: ${entry.hit_count}</p>
                    <p>–ú–µ—Ç–æ–¥ –ø–æ–∏—Å–∫–∞: ${entry.search_method}</p>
                    <div>
                        <button onclick="viewSavedData(${index})">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
                        <button class="delete-btn" onclick="deleteSavedData('${entry.email}', ${index})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
            `).join('');
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
            window.savedDataResults = results;

            savedDataContainer.innerHTML = html;
        }

        function viewSavedData(index) {
            if (window.savedDataResults && window.savedDataResults[index]) {
                currentData = window.savedDataResults[index].data;
                displayResults(currentData);
                showTab('basic');
            } else {
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
            }
        }

        async function deleteSavedData(email, index) {
            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è email: ${email}?`)) {
                return;
            }
            
            try {
                const response = await fetch('/api/cache/email-data/delete', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email: email })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                alert(`–î–∞–Ω–Ω—ã–µ –¥–ª—è email ${email} —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω—ã`);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                loadSavedData();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö: ' + error.message);
            }
        }

        function displayBasicInfo(data) {
            const basicInfo = data.basic_info || {};
            const professionalInfo = data.professional_info || {};
            const scientificIds = data.scientific_identifiers || {};

            const html = `
                <div class="info-card">
                    <h3>üë§ –í–ª–∞–¥–µ–ª–µ—Ü Email</h3>
                    <p><strong>–ò–º—è:</strong> ${basicInfo.owner_name || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ'}</p>
                    <p><strong>–ê–Ω–≥–ª–∏–π—Å–∫–æ–µ –∏–º—è:</strong> ${basicInfo.owner_name_en || 'Not determined'}</p>
                    <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${getStatusText(basicInfo.status)}</p>
                    ${basicInfo.confidence_score ? `<p><strong>–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å:</strong> ${Math.round(basicInfo.confidence_score * 100)}%</p>` : ''}
                </div>
                
                <div class="info-card">
                    <h3>üíº –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                    <p><strong>–î–æ–ª–∂–Ω–æ—Å—Ç—å:</strong> ${professionalInfo.position || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ'}</p>
                    <p><strong>–ú–µ—Å—Ç–æ —Ä–∞–±–æ—Ç—ã:</strong> ${professionalInfo.workplace || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ'}</p>
                    <p><strong>–ê–¥—Ä–µ—Å:</strong> ${professionalInfo.address || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ'}</p>
                    <p><strong>–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:</strong> ${professionalInfo.specialization || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ'}</p>
                    ${professionalInfo.degrees ? `<p><strong>–°—Ç–µ–ø–µ–Ω–∏:</strong> ${professionalInfo.degrees.join(', ')}</p>` : ''}
                </div>
                
                <div class="info-card">
                    <h3>üî¨ –ù–∞—É—á–Ω—ã–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã</h3>
                    <p><strong>ORCID ID:</strong> ${scientificIds.orcid_id || '–ù–µ –Ω–∞–π–¥–µ–Ω'}</p>
                    <p><strong>SPIN –∫–æ–¥:</strong> ${scientificIds.spin_code || '–ù–µ –Ω–∞–π–¥–µ–Ω'}</p>
                    <p><strong>Email –¥–ª—è –∫–æ—Ä—Ä–µ—Å–ø–æ–Ω–¥–µ–Ω—Ü–∏–∏:</strong> ${scientificIds.email_for_correspondence || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'}</p>
                    ${scientificIds.alternative_emails ? `<p><strong>–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ email:</strong> ${scientificIds.alternative_emails.join(', ')}</p>` : ''}
                </div>
                
                <div class="info-card">
                    <h3>üìä –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–æ–∏—Å–∫–∞</h3>
                    <p><strong>–ù–∞–π–¥–µ–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:</strong> ${data.search_metadata?.results_count || 0}</p>
                    <p><strong>–ú–µ—Ç–æ–¥ –ø–æ–∏—Å–∫–∞:</strong> ${getSearchMethodText(data.search_metadata?.search_method)}</p>
                    <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${data.search_metadata?.status || 'unknown'}</p>
                    <p><strong>–ò—Å—Ç–æ—á–Ω–∏–∫–∏:</strong> ${data.information_sources?.length || 0} –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤</p>
                </div>
            `;

            document.getElementById('basicInfo').innerHTML = html;
        }

        function displayWebpageAnalysis(data) {
            const webpageAnalysis = data.webpage_analysis;
            
            if (!webpageAnalysis) {
                document.getElementById('webpageAnalysis').innerHTML = `
                    <div class="error-message">
                        –ê–Ω–∞–ª–∏–∑ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li>–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</li>
                            <li>–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü –æ—Ç–∫–ª—é—á–µ–Ω</li>
                            <li>–ù–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö —Å—Å—ã–ª–æ–∫ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</li>
                        </ul>
                    </div>
                `;
                return;
            }

            const ownerData = webpageAnalysis.owner_identification || {};
            const professionalData = webpageAnalysis.professional_details || {};
            const contactData = webpageAnalysis.contact_information || {};
            const academicData = webpageAnalysis.academic_info || {};
            const metaData = webpageAnalysis.analysis_metadata || {};

            const html = `
                <div class="analysis-header">
                    <h2>üîç –ê–Ω–∞–ª–∏–∑ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü</h2>
                    <div class="confidence-score">
                        –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ${Math.round((ownerData.confidence_score || 0) * 100)}%
                    </div>
                </div>

                <div class="analysis-grid">
                    <div class="analysis-section">
                        <h3><span class="section-icon">üë§</span>–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤–ª–∞–¥–µ–ª—å—Ü–∞</h3>
                        <div class="extracted-data">
                            <p><strong>–ù–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω–æ–µ –∏–º—è:</strong> ${ownerData.most_likely_name || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ'}</p>
                            <p><strong>–ù–∞–π–¥–µ–Ω–æ –∏–º–µ–Ω:</strong> ${ownerData.names_found?.length || 0}</p>
                            ${ownerData.name_variations?.length ? `
                                <p><strong>–í–∞—Ä–∏–∞—Ü–∏–∏ –∏–º–µ–Ω:</strong></p>
                                <div>
                                    ${ownerData.name_variations.map(name => `<span class="data-item">${name}</span>`).join('')}
                                </div>
                            ` : ''}
                        </div>
                    </div>

                    <div class="analysis-section">
                        <h3><span class="section-icon">üíº</span>–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
                        <div class="extracted-data">
                            ${professionalData.positions?.length ? `
                                <p><strong>–î–æ–ª–∂–Ω–æ—Å—Ç–∏:</strong></p>
                                <div>
                                    ${professionalData.positions.map(pos => `<span class="data-item">${pos}</span>`).join('')}
                                </div>
                            ` : '<p>–î–æ–ª–∂–Ω–æ—Å—Ç–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>'}
                            
                            ${professionalData.organizations?.length ? `
                                <p><strong>–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏:</strong></p>
                                <div>
                                    ${professionalData.organizations.map(org => `<span class="data-item">${org}</span>`).join('')}
                                </div>
                            ` : '<p>–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>'}
                            
                            ${professionalData.locations?.length ? `
                                <p><strong>–õ–æ–∫–∞—Ü–∏–∏:</strong></p>
                                <div>
                                    ${professionalData.locations.map(loc => `<span class="data-item">${loc}</span>`).join('')}
                                </div>
                            ` : '<p>–õ–æ–∫–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>'}
                        </div>
                    </div>

                    <div class="analysis-section">
                        <h3><span class="section-icon">üìû</span>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                        <div class="extracted-data">
                            ${contactData.emails?.length ? `
                                <p><strong>Email –∞–¥—Ä–µ—Å–∞:</strong></p>
                                <div>
                                    ${contactData.emails.map(email => `<span class="data-item">${email}</span>`).join('')}
                                </div>
                            ` : '<p>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ email –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>'}
                            
                            ${contactData.phones?.length ? `
                                <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω—ã:</strong></p>
                                <div>
                                    ${contactData.phones.map(phone => `<span class="data-item">${phone}</span>`).join('')}
                                </div>
                            ` : '<p>–¢–µ–ª–µ—Ñ–æ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>'}
                        </div>
                    </div>

                    <div class="analysis-section">
                        <h3><span class="section-icon">üéì</span>–ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                        <div class="extracted-data">
                            ${academicData.degrees?.length ? `
                                <p><strong>–£—á–µ–Ω—ã–µ —Å—Ç–µ–ø–µ–Ω–∏:</strong></p>
                                <div>
                                    ${academicData.degrees.map(degree => `<span class="data-item">${degree}</span>`).join('')}
                                </div>
                            ` : '<p>–£—á–µ–Ω—ã–µ —Å—Ç–µ–ø–µ–Ω–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>'}
                            
                            ${academicData.research_areas?.length ? `
                                <p><strong>–û–±–ª–∞—Å—Ç–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π:</strong></p>
                                <div>
                                    ${academicData.research_areas.slice(0, 5).map(area => `<span class="data-item">${area}</span>`).join('')}
                                </div>
                            ` : '<p>–û–±–ª–∞—Å—Ç–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>'}
                        </div>
                    </div>
                </div>

                <div class="url-analysis">
                    <h3>üåê –ê–Ω–∞–ª–∏–∑ URL –∞–¥—Ä–µ—Å–æ–≤</h3>
                    <p style="margin-bottom: 15px; color: #666;">
                        –£—Å–ø–µ—à–Ω–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: <strong>${metaData.successful_extractions || 0}</strong> –∏–∑ <strong>${metaData.analyzed_urls?.length || 0}</strong> —Å—Ç—Ä–∞–Ω–∏—Ü
                    </p>
                    
                    ${metaData.analyzed_urls?.length ? metaData.analyzed_urls.map(urlData => `
                        <div class="url-item ${urlData.status === 'success' ? 'success' : 'failed'}">
                            <a href="${urlData.url}" target="_blank" class="url">${urlData.url}</a>
                            <span class="status ${urlData.status}">${getUrlStatusText(urlData.status)}</span>
                            ${urlData.extracted_data_types ? `
                                <div style="margin-top: 8px;">
                                    <small><strong>–ò–∑–≤–ª–µ—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ:</strong> ${urlData.extracted_data_types.join(', ')}</small>
                                </div>
                            ` : ''}
                            ${urlData.reason ? `
                                <div style="margin-top: 8px;">
                                    <small><strong>–ü—Ä–∏—á–∏–Ω–∞:</strong> ${urlData.reason}</small>
                                </div>
                            ` : ''}
                        </div>
                    `).join('') : '<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ–± –∞–Ω–∞–ª–∏–∑–µ URL</p>'}
                </div>
            `;

            document.getElementById('webpageAnalysis').innerHTML = html;
        }

        function displayPublications(data) {
            const publications = data.publications || [];
            
            if (publications.length === 0) {
                document.getElementById('publicationsContent').innerHTML = `
                    <div class="error-message">
                        –ü—É–±–ª–∏–∫–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –∏–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∏—Ö –∏–∑–≤–ª–µ—á—å –∏–∑ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.
                    </div>
                `;
                return;
            }

            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–Ω–∞–ª–∏–∑–∞
            const analysisStats = analyzePublicationsStats(publications);
            
            let html = `
                <div class="publications-overview" style="
                    background: #f8f9fa;
                    padding: 20px;
                    border-radius: 10px;
                    margin-bottom: 20px;
                    border-left: 4px solid #667eea;
                ">
                    <h3 style="margin: 0 0 15px 0; color: #333;">üìä –û–±–∑–æ—Ä –ø—É–±–ª–∏–∫–∞—Ü–∏–π</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: #667eea; margin-bottom: 5px;">${publications.length}</div>
                            <div style="font-size: 0.9rem; color: #666;">–í—Å–µ–≥–æ –ø—É–±–ª–∏–∫–∞—Ü–∏–π</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: #28a745; margin-bottom: 5px;">${analysisStats.withPhase42}</div>
                            <div style="font-size: 0.9rem; color: #666;">–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ Phase 4.2</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: #ffc107; margin-bottom: 5px;">${analysisStats.uniqueJournals}</div>
                            <div style="font-size: 0.9rem; color: #666;">–†–∞–∑–ª–∏—á–Ω—ã—Ö –∂—É—Ä–Ω–∞–ª–æ–≤</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: #17a2b8; margin-bottom: 5px;">${analysisStats.recentPublications}</div>
                            <div style="font-size: 0.9rem; color: #666;">–ü—É–±–ª–∏–∫–∞—Ü–∏–∏ 2023-2025</div>
                        </div>
                    </div>
                    ${analysisStats.researchFields.length > 0 ? `
                        <div style="margin-top: 15px;">
                            <h4 style="margin: 0 0 10px 0; color: #333;">üéØ –û–±–ª–∞—Å—Ç–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π:</h4>
                            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                ${analysisStats.researchFields.map(field => `<span style="background: #667eea; color: white; padding: 4px 12px; border-radius: 15px; font-size: 0.8rem;">${field}</span>`).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;

            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø–æ –≥–æ–¥–∞–º
            const publicationsByYear = groupPublicationsByYear(publications);
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø–æ –≥–æ–¥–∞–º
            Object.keys(publicationsByYear).sort((a, b) => b - a).forEach(year => {
                html += `<h4 style="margin: 20px 0 15px 0; color: #333;">üìÖ ${year} –≥–æ–¥ (${publicationsByYear[year].length} –ø—É–±–ª–∏–∫–∞—Ü–∏–π)</h4>`;
                
                publicationsByYear[year].forEach(pub => {
                    html += createPublicationCard(pub);
                });
            });

            document.getElementById('publicationsContent').innerHTML = html;
        }
        
        function createPublicationCard(pub) {
            const metadata = pub.metadata || {};
            const originalData = pub.original_data || {};
            const authorRole = pub.author_role || {};
            const thematic = pub.thematic_classification || {};
            
            // –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞
            const title = metadata.title || originalData.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
            const journal = metadata.journal || originalData.journal || '–ù–µ —É–∫–∞–∑–∞–Ω';
            const year = metadata.publication_date || originalData.year || '–ù–µ —É–∫–∞–∑–∞–Ω';
            const doi = metadata.doi || '–ù–µ –Ω–∞–π–¥–µ–Ω';
            const authors = metadata.authors ? 
                (Array.isArray(metadata.authors) ? metadata.authors.join(', ') : metadata.authors) : 
                '–ù–µ —É–∫–∞–∑–∞–Ω—ã';
            const pmid = metadata.pmid || '–ù–µ –Ω–∞–π–¥–µ–Ω';
            const language = metadata.language || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω';
            
            return `
                <div class="publication-item" style="
                    background: #f8f9fa;
                    border-radius: 10px;
                    padding: 20px;
                    margin-bottom: 20px;
                    border-left: 4px solid #28a745;
                ">
                    <div class="publication-title" style="
                        font-size: 1.2rem;
                        font-weight: bold;
                        color: #333;
                        margin-bottom: 15px;
                        line-height: 1.4;
                    ">${title}</div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-bottom: 15px;">
                        <div style="background: white; padding: 15px; border-radius: 8px;">
                            <h4 style="margin: 0 0 10px 0; color: #667eea; font-size: 1rem;">üìÑ –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h4>
                            <div style="margin-bottom: 8px; font-size: 0.9rem;"><strong>–ñ—É—Ä–Ω–∞–ª:</strong> ${journal}</div>
                            <div style="margin-bottom: 8px; font-size: 0.9rem;"><strong>–ì–æ–¥:</strong> ${year}</div>
                            <div style="margin-bottom: 8px; font-size: 0.9rem;"><strong>DOI:</strong> ${doi}</div>
                            <div style="margin-bottom: 8px; font-size: 0.9rem;"><strong>PMID:</strong> ${pmid}</div>
                            <div style="margin-bottom: 8px; font-size: 0.9rem;"><strong>–Ø–∑—ã–∫:</strong> ${language}</div>
                        </div>
                        
                        ${Object.keys(authorRole).length > 0 ? `
                            <div style="background: white; padding: 15px; border-radius: 8px;">
                                <h4 style="margin: 0 0 10px 0; color: #667eea; font-size: 1rem;">üë§ –†–æ–ª—å –∞–≤—Ç–æ—Ä–∞</h4>
                                <div style="margin-bottom: 8px;">
                                    <span style="background: #28a745; color: white; padding: 4px 12px; border-radius: 15px; font-size: 0.8rem;">
                                        ${authorRole.author_contribution || '–°–æ–∞–≤—Ç–æ—Ä'}
                                    </span>
                                </div>
                                <div style="margin-bottom: 8px; font-size: 0.9rem;"><strong>–ü–µ—Ä–≤—ã–π –∞–≤—Ç–æ—Ä:</strong> ${authorRole.is_first_author ? '–î–∞' : '–ù–µ—Ç'}</div>
                                <div style="margin-bottom: 8px; font-size: 0.9rem;"><strong>–ö–æ—Ä—Ä–µ—Å–ø–æ–Ω–¥–∏—Ä—É—é—â–∏–π:</strong> ${authorRole.is_corresponding_author ? '–î–∞' : '–ù–µ—Ç'}</div>
                                <div style="margin-bottom: 8px; font-size: 0.9rem;"><strong>–í—Å–µ–≥–æ –∞–≤—Ç–æ—Ä–æ–≤:</strong> ${authorRole.total_authors || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ'}</div>
                            </div>
                        ` : ''}
                        
                        ${Object.keys(thematic).length > 0 ? `
                            <div style="background: white; padding: 15px; border-radius: 8px;">
                                <h4 style="margin: 0 0 10px 0; color: #667eea; font-size: 1rem;">üî¨ –¢–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è</h4>
                                <div style="margin-bottom: 8px; font-size: 0.9rem;"><strong>–û–±–ª–∞—Å—Ç—å:</strong> ${thematic.research_field || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞'}</div>
                                ${thematic.sub_fields && thematic.sub_fields.length > 0 ? `
                                    <div style="margin-bottom: 8px; font-size: 0.9rem;"><strong>–ü–æ–¥–æ–±–ª–∞—Å—Ç–∏:</strong> ${thematic.sub_fields.join(', ')}</div>
                                ` : ''}
                                ${thematic.medical_specialties && thematic.medical_specialties.length > 0 ? `
                                    <div style="margin-bottom: 8px; font-size: 0.9rem;"><strong>–ú–µ–¥. —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏:</strong> ${thematic.medical_specialties.join(', ')}</div>
                                ` : ''}
                                <div style="margin-bottom: 8px; font-size: 0.9rem;"><strong>–ö–ª–∏–Ω–∏—á–µ—Å–∫–∞—è –∑–Ω–∞—á–∏–º–æ—Å—Ç—å:</strong> ${thematic.clinical_relevance || '–ù–µ –æ—Ü–µ–Ω–µ–Ω–∞'}</div>
                            </div>
                        ` : ''}
                    </div>
                    
                    <div style="margin-bottom: 8px; font-size: 0.9rem;"><strong>–ê–≤—Ç–æ—Ä—ã:</strong> ${authors}</div>
                    
                    ${pub.analysis_timestamp ? `
                        <div style="margin-top: 15px; color: #666; font-size: 0.8rem; border-top: 1px solid #dee2e6; padding-top: 10px;">
                            ‚è∞ –ê–Ω–∞–ª–∏–∑ Phase 4.2 –≤—ã–ø–æ–ª–Ω–µ–Ω: ${new Date(pub.analysis_timestamp * 1000).toLocaleString('ru-RU')}
                        </div>
                    ` : ''}
                </div>
            `;
        }
        
        function analyzePublicationsStats(publications) {
            const journals = new Set();
            const fields = new Set();
            let withPhase42 = 0;
            let recentCount = 0;
            
            publications.forEach(pub => {
                // –ñ—É—Ä–Ω–∞–ª—ã
                const journal = pub.metadata?.journal || pub.original_data?.journal;
                if (journal) journals.add(journal);
                
                // Phase 4.2 –∞–Ω–∞–ª–∏–∑
                if (pub.analysis_timestamp) withPhase42++;
                
                // –ù–µ–¥–∞–≤–Ω–∏–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
                const year = parseInt(pub.metadata?.publication_date || pub.original_data?.year);
                if (year >= 2023) recentCount++;
                
                // –û–±–ª–∞—Å—Ç–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π
                const thematic = pub.thematic_classification || {};
                if (thematic.research_field) fields.add(thematic.research_field);
                if (thematic.sub_fields) {
                    thematic.sub_fields.forEach(field => fields.add(field));
                }
                if (thematic.medical_specialties) {
                    thematic.medical_specialties.forEach(spec => fields.add(spec));
                }
            });
            
            return {
                withPhase42,
                uniqueJournals: journals.size,
                recentPublications: recentCount,
                researchFields: Array.from(fields).filter(field => field && field !== '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞')
            };
        }
        
        function groupPublicationsByYear(publications) {
            const groups = {};
            
            publications.forEach(pub => {
                const year = pub.metadata?.publication_date || pub.original_data?.year || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                if (!groups[year]) groups[year] = [];
                groups[year].push(pub);
            });
            
            return groups;
        }

        function displayTimeline(data) {
            const publications = data.publications || [];
            const searchMetadata = data.search_metadata || {};
            const basicInfo = data.basic_info || {};
            const professionalInfo = data.professional_info || {};
            const scientificIds = data.scientific_identifiers || {};
            const webpageAnalysis = data.webpage_analysis || {};
            
            let timelineEvents = [];
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ timeline —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ–º –≥–æ–¥–∞
            publications.forEach(pub => {
                let year = pub.metadata?.publication_date || pub.original_data?.year;
                
                // –ü—ã—Ç–∞–µ–º—Å—è –∏–∑–≤–ª–µ—á—å –≥–æ–¥ –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏–ª–∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏
                if (!year) {
                    const text = (pub.title || '') + ' ' + (pub.abstract || '');
                    const yearMatch = text.match(/\b(20[0-2][0-9])\b|\b(19[8-9][0-9])\b/);
                    if (yearMatch) {
                        year = yearMatch[1] || yearMatch[2];
                    }
                }
                
                // –ü—ã—Ç–∞–µ–º—Å—è –∏–∑–≤–ª–µ—á—å –≥–æ–¥ –∏–∑ URL
                if (!year && pub.url) {
                    const urlYearMatch = pub.url.match(/\/(20[0-2][0-9])\//); 
                    if (urlYearMatch) {
                        year = urlYearMatch[1];
                    }
                }
                
                // –ï—Å–ª–∏ –µ—Å—Ç—å analysis_timestamp, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ –∫–∞–∫ fallback
                if (!year && pub.analysis_timestamp) {
                    year = new Date(pub.analysis_timestamp * 1000).getFullYear();
                }
                
                if (year) {
                    const title = pub.metadata?.title || pub.original_data?.title || '–ü—É–±–ª–∏–∫–∞—Ü–∏—è –±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
                    const journal = pub.metadata?.journal || pub.original_data?.journal || '–ù–µ —É–∫–∞–∑–∞–Ω';
                    const authors = pub.metadata?.authors ? 
                        (Array.isArray(pub.metadata.authors) ? pub.metadata.authors.join(', ') : pub.metadata.authors) : 
                        '–ê–≤—Ç–æ—Ä—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã';
                    const type = pub.type || 'article';
                    
                    timelineEvents.push({
                        year: parseInt(year),
                        type: 'publication',
                        subtype: type,
                        title: title,
                        description: `–ñ—É—Ä–Ω–∞–ª: ${journal}`,
                        authors: authors,
                        url: pub.url
                    });
                }
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞—Ä—å–µ—Ä–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –∏–∑ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
            if (professionalInfo.workplace && professionalInfo.workplace !== '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ') {
                // –ü—ã—Ç–∞–µ–º—Å—è –∏–∑–≤–ª–µ—á—å –≥–æ–¥ –∏–∑ —Ç–µ–∫—Å—Ç–∞ —Ä–∞–±–æ—á–µ–≥–æ –º–µ—Å—Ç–∞
                const workplaceYear = extractYearFromText(professionalInfo.workplace);
                if (workplaceYear) {
                    timelineEvents.push({
                        year: parseInt(workplaceYear),
                        type: 'career',
                        title: '–ö–∞—Ä—å–µ—Ä–Ω–∞—è –≤–µ—Ö–∞',
                        description: `–†–∞–±–æ—Ç–∞: ${professionalInfo.workplace}`,
                        subinfo: professionalInfo.position || '–ü–æ–∑–∏—Ü–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω–∞'
                    });
                }
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
            if (professionalInfo.degrees && professionalInfo.degrees.length > 0) {
                professionalInfo.degrees.forEach(degree => {
                    const degreeYear = extractYearFromText(degree);
                    if (degreeYear) {
                        timelineEvents.push({
                            year: parseInt(degreeYear),
                            type: 'education',
                            title: '–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–µ–ø–µ–Ω–∏',
                            description: `–°—Ç–µ–ø–µ–Ω—å: ${degree}`,
                            subinfo: professionalInfo.workplace || '–£—á—Ä–µ–∂–¥–µ–Ω–∏–µ –Ω–µ —É–∫–∞–∑–∞–Ω–æ'
                        });
                    }
                });
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏—è –∏–∑ –∞–Ω–∞–ª–∏–∑–∞ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü
            if (webpageAnalysis.analysis_metadata?.analysis_timestamp) {
                timelineEvents.push({
                    year: new Date(webpageAnalysis.analysis_metadata.analysis_timestamp * 1000).getFullYear(),
                    type: 'analysis',
                    title: '–ê–Ω–∞–ª–∏–∑ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü',
                    description: `–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ ${webpageAnalysis.analysis_metadata.successful_extractions || 0} —Å—Ç—Ä–∞–Ω–∏—Ü`,
                    subinfo: `–ò–∑–≤–ª–µ—á–µ–Ω–æ –¥–∞–Ω–Ω—ã—Ö: ${webpageAnalysis.analysis_metadata.analyzed_urls?.length || 0} URL`
                });
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –ø–æ–∏—Å–∫
            if (searchMetadata.timestamp) {
                timelineEvents.push({
                    year: new Date(searchMetadata.timestamp * 1000).getFullYear(),
                    type: 'search',
                    title: '–ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö',
                    description: `–ù–∞–π–¥–µ–Ω–æ ${searchMetadata.results_count || 0} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤`,
                    subinfo: `–ú–µ—Ç–æ–¥: ${getSearchMethodText(searchMetadata.search_method)}`
                });
            }
            
            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏—è –ø–æ –≥–æ–¥–∞–º –∏ —Ç–∏–ø–∞–º
            const groupedEvents = groupTimelineEvents(timelineEvents);
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –≥–æ–¥–∞–º (–Ω–æ–≤—ã–µ —Å–Ω–∞—á–∞–ª–∞)
            const sortedYears = Object.keys(groupedEvents).sort((a, b) => parseInt(b) - parseInt(a));
            
            if (timelineEvents.length === 0) {
                document.getElementById('timelineContent').innerHTML = `
                    <div class="error-message">
                        –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π —à–∫–∞–ª—ã.
                        –ü—É–±–ª–∏–∫–∞—Ü–∏–∏ –Ω–∞–π–¥–µ–Ω—ã, –Ω–æ –≤ –Ω–∏—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏.
                    </div>
                `;
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤—Ä–µ–º–µ–Ω–Ω–æ–π —à–∫–∞–ª—ã
            const stats = calculateTimelineStats(timelineEvents);
            
            let html = `
                <h3>‚è∞ –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h3>
                <div class="timeline-stats" style="
                    background: #f8f9fa;
                    padding: 15px;
                    border-radius: 10px;
                    margin: 20px 0;
                    border-left: 4px solid #667eea;
                ">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                        <div style="text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #667eea;">${stats.totalEvents}</div>
                            <div style="font-size: 0.9rem; color: #666;">–í—Å–µ–≥–æ —Å–æ–±—ã—Ç–∏–π</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #28a745;">${stats.publicationsCount}</div>
                            <div style="font-size: 0.9rem; color: #666;">–ü—É–±–ª–∏–∫–∞—Ü–∏–π</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #ffc107;">${stats.yearsSpan}</div>
                            <div style="font-size: 0.9rem; color: #666;">–õ–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #17a2b8;">${stats.recentActivity}</div>
                            <div style="font-size: 0.9rem; color: #666;">–ù–µ–¥–∞–≤–Ω–∏—Ö —Å–æ–±—ã—Ç–∏–π</div>
                        </div>
                    </div>
                </div>
                <div class="timeline-container" style="margin-top: 20px;">
            `;
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–æ–±—ã—Ç–∏—è –ø–æ –≥–æ–¥–∞–º
            sortedYears.forEach(year => {
                const yearEvents = groupedEvents[year];
                html += `
                    <div class="timeline-year" style="margin-bottom: 30px;">
                        <h4 style="
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            color: white;
                            padding: 10px 20px;
                            border-radius: 25px;
                            margin: 0 0 15px 0;
                            text-align: center;
                            font-size: 1.1rem;
                        ">
                            üìÖ ${year} –≥–æ–¥ (${yearEvents.length} —Å–æ–±—ã—Ç–∏–π)
                        </h4>
                `;
                
                yearEvents.forEach(event => {
                    html += createTimelineEventCard(event);
                });
                
                html += `</div>`;
            });
            
            html += `</div>`;
            
            document.getElementById('timelineContent').innerHTML = html;
        }
        
        function extractYearFromText(text) {
            if (!text) return null;
            const yearMatch = text.match(/\b(20[0-2][0-9])\b|\b(19[8-9][0-9])\b/);
            return yearMatch ? (yearMatch[1] || yearMatch[2]) : null;
        }
        
        function groupTimelineEvents(events) {
            const grouped = {};
            events.forEach(event => {
                const year = event.year.toString();
                if (!grouped[year]) {
                    grouped[year] = [];
                }
                grouped[year].push(event);
            });
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏—è –≤–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–≥–æ –≥–æ–¥–∞ –ø–æ —Ç–∏–ø—É
            Object.keys(grouped).forEach(year => {
                grouped[year].sort((a, b) => {
                    const typeOrder = { 'education': 0, 'career': 1, 'publication': 2, 'analysis': 3, 'search': 4 };
                    return (typeOrder[a.type] || 5) - (typeOrder[b.type] || 5);
                });
            });
            
            return grouped;
        }
        
        function calculateTimelineStats(events) {
            const years = events.map(e => e.year).filter(y => y);
            const currentYear = new Date().getFullYear();
            
            return {
                totalEvents: events.length,
                publicationsCount: events.filter(e => e.type === 'publication').length,
                yearsSpan: years.length > 0 ? Math.max(...years) - Math.min(...years) + 1 : 0,
                recentActivity: events.filter(e => e.year >= currentYear - 2).length
            };
        }
        
        function createTimelineEventCard(event) {
            const typeConfig = {
                'publication': { icon: 'üìö', color: '#667eea', bgColor: '#e3f2fd' },
                'education': { icon: 'üéì', color: '#4caf50', bgColor: '#e8f5e8' },
                'career': { icon: 'üíº', color: '#ff9800', bgColor: '#fff3e0' },
                'analysis': { icon: 'üîç', color: '#9c27b0', bgColor: '#f3e5f5' },
                'search': { icon: 'üîé', color: '#607d8b', bgColor: '#eceff1' }
            };
            
            const config = typeConfig[event.type] || typeConfig['search'];
            
            return `
                <div class="timeline-item" style="
                    background: ${config.bgColor};
                    padding: 20px;
                    border-radius: 10px;
                    margin-bottom: 15px;
                    border-left: 4px solid ${config.color};
                    transition: transform 0.2s, box-shadow 0.2s;
                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(0,0,0,0.1)'" 
                   onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <div style="flex: 1;">
                            <h4 style="margin: 0 0 8px 0; color: ${config.color}; display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 1.2rem;">${config.icon}</span>
                                ${event.title}
                                ${event.subtype ? `<span style="background: ${config.color}; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.7rem; text-transform: uppercase;">${event.subtype}</span>` : ''}
                            </h4>
                            <p style="margin: 0 0 5px 0; color: #666; font-size: 14px;">${event.description}</p>
                            ${event.authors ? `<p style="margin: 0 0 5px 0; color: #888; font-size: 12px;"><strong>–ê–≤—Ç–æ—Ä—ã:</strong> ${event.authors}</p>` : ''}
                            ${event.subinfo ? `<p style="margin: 0; color: #999; font-size: 12px;"><strong>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:</strong> ${event.subinfo}</p>` : ''}
                            ${event.url ? `<a href="${event.url}" target="_blank" style="color: ${config.color}; text-decoration: none; font-size: 12px;">üîó –ü–µ—Ä–µ–π—Ç–∏ –∫ –∏—Å—Ç–æ—á–Ω–∏–∫—É</a>` : ''}
                        </div>
                        <div style="
                            background: ${config.color};
                            color: white;
                            padding: 8px 12px;
                            border-radius: 20px;
                            font-weight: 600;
                            font-size: 14px;
                            min-width: 60px;
                            text-align: center;
                            margin-left: 15px;
                        ">
                            ${event.year}
                        </div>
                    </div>
                </div>
            `;
        }
        
        function displayNetworks(data) {
            const contactInfo = data.webpage_analysis?.contact_information || {};
            const professionalInfo = data.professional_info || {};
            const scientificIds = data.scientific_identifiers || {};
            const basicInfo = data.basic_info || {};
            
            let networks = [];
            
            // Email —Å–µ—Ç–∏
            if (contactInfo.emails && contactInfo.emails.length > 0) {
                networks.push({
                    type: 'email',
                    title: 'Email –∞–¥—Ä–µ—Å–∞',
                    items: contactInfo.emails,
                    icon: 'üìß'
                });
            }
            
            // –ù–∞—É—á–Ω—ã–µ —Å–µ—Ç–∏
            if (scientificIds.orcid_id && scientificIds.orcid_id !== '–ù–µ –Ω–∞–π–¥–µ–Ω') {
                networks.push({
                    type: 'scientific',
                    title: 'ORCID',
                    items: [scientificIds.orcid_id],
                    icon: 'üî¨',
                    links: [`https://orcid.org/${scientificIds.orcid_id}`]
                });
            }
            
            // –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–≤—è–∑–∏
            if (professionalInfo.workplace && professionalInfo.workplace !== '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ') {
                networks.push({
                    type: 'organization',
                    title: '–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è',
                    items: [professionalInfo.workplace],
                    icon: 'üè¢'
                });
            }
            
            // –°–∞–π—Ç—ã –∏ –ø—Ä–æ—Ñ–∏–ª–∏
            if (contactInfo.websites && contactInfo.websites.length > 0) {
                networks.push({
                    type: 'web',
                    title: '–í–µ–±-–ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ',
                    items: contactInfo.websites,
                    icon: 'üåê',
                    links: contactInfo.websites
                });
            }
            
            if (networks.length === 0) {
                document.getElementById('networksContent').innerHTML = `
                    <div class="error-message">
                        –°–µ—Ç–µ–≤—ã–µ —Å–≤—è–∑–∏ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã. 
                        –î–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∫–∞—Ä—Ç—ã —Å–≤—è–∑–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –±–æ–ª—å—à–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–Ω—Ç–∞–∫—Ç–∞—Ö –∏ –ø—Ä–æ—Ñ–∏–ª—è—Ö.
                    </div>
                `;
                return;
            }
            
            const html = `
                <h3>üåê –°–µ—Ç–∏ –∏ —Å–≤—è–∑–∏</h3>
                <div class="networks-grid" style="
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                    gap: 20px;
                    margin-top: 20px;
                ">
                    ${networks.map(network => `
                        <div class="network-item" style="
                            background: #f8f9fa;
                            padding: 20px;
                            border-radius: 10px;
                            border-left: 4px solid #667eea;
                        ">
                            <h4 style="margin: 0 0 15px 0; color: #333; display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 20px;">${network.icon}</span>
                                ${network.title}
                            </h4>
                            <div class="network-items">
                                ${network.items.map((item, index) => {
                                    const link = network.links && network.links[index];
                                    return `
                                        <div style="
                                            background: white;
                                            padding: 10px 15px;
                                            border-radius: 8px;
                                            margin-bottom: 8px;
                                            border: 1px solid #e1e5e9;
                                        ">
                                            ${link ? 
                                                `<a href="${link}" target="_blank" style="color: #667eea; text-decoration: none; font-weight: 500;">${item}</a>` : 
                                                `<span style="color: #333; font-weight: 500;">${item}</span>`
                                            }
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                ${networks.length > 1 ? `
                    <div style="
                        margin-top: 30px;
                        padding: 20px;
                        background: #e3f2fd;
                        border-radius: 10px;
                        border-left: 4px solid #2196f3;
                    ">
                        <h4 style="margin: 0 0 10px 0; color: #1976d2;">üìä –ê–Ω–∞–ª–∏–∑ —Å–≤—è–∑–µ–π</h4>
                        <p style="margin: 0; color: #1976d2; font-size: 14px;">
                            –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ <strong>${networks.length}</strong> —Ç–∏–ø–æ–≤ —Å–µ—Ç–µ–≤—ã—Ö —Å–≤—è–∑–µ–π. 
                            –≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ ${networks.length >= 3 ? '–≤—ã—Å–æ–∫—É—é' : networks.length >= 2 ? '—Å—Ä–µ–¥–Ω—é—é' : '–Ω–∏–∑–∫—É—é'} 
                            —Å—Ç–µ–ø–µ–Ω—å —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è.
                        </p>
                    </div>
                ` : ''}
            `;
            
            document.getElementById('networksContent').innerHTML = html;
        }
        
        function displayConclusions(data) {
            const conclusions = data.conclusions || [];
            const researchInterests = data.research_interests || [];
            const searchMetadata = data.search_metadata || {};
            const informationSources = data.information_sources || [];

            let html = '';

            if (conclusions.length > 0) {
                html += '<h3>üí° –û—Å–Ω–æ–≤–Ω—ã–µ –≤—ã–≤–æ–¥—ã</h3>';
                conclusions.forEach(conclusion => {
                    html += `<div class="conclusion-item">‚Ä¢ ${conclusion}</div>`;
                });
            }

            if (researchInterests.length > 0) {
                html += '<h3 style="margin-top: 30px;">üî¨ –û–±–ª–∞—Å—Ç–∏ –Ω–∞—É—á–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤</h3>';
                html += '<div style="margin-top: 15px;">';
                researchInterests.forEach(interest => {
                    html += `<span class="data-item">${interest}</span>`;
                });
                html += '</div>';
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∞–ª–∏—Ç–∏–∫—É
            html += '<h3 style="margin-top: 30px;">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ–∏—Å–∫–∞</h3>';
            html += `
                <div style="
                    background: #f0f8ff;
                    padding: 20px;
                    border-radius: 10px;
                    border-left: 4px solid #667eea;
                    margin-top: 15px;
                ">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div>
                            <strong>–†–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–∞–π–¥–µ–Ω–æ:</strong><br>
                            <span style="font-size: 24px; color: #667eea;">${searchMetadata.results_count || 0}</span>
                        </div>
                        <div>
                            <strong>–ò—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö:</strong><br>
                            <span style="font-size: 24px; color: #4caf50;">${informationSources.length || 0}</span>
                        </div>
                        <div>
                            <strong>–ú–µ—Ç–æ–¥ –ø–æ–∏—Å–∫–∞:</strong><br>
                            <span style="font-size: 14px; color: #666;">${getSearchMethodText(searchMetadata.search_method)}</span>
                        </div>
                        <div>
                            <strong>–í—Ä–µ–º—è –∞–Ω–∞–ª–∏–∑–∞:</strong><br>
                            <span style="font-size: 14px; color: #666;">
                                ${searchMetadata.timestamp ? new Date(searchMetadata.timestamp * 1000).toLocaleString('ru-RU') : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}
                            </span>
                        </div>
                    </div>
                </div>
            `;
            
            if (informationSources.length > 0) {
                html += '<h4 style="margin-top: 25px;">üìã –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏</h4>';
                html += '<div style="margin-top: 15px;">';
                informationSources.forEach(source => {
                    html += `<span class="data-item" style="background: #e8f5e8; color: #2e7d2e;">${source}</span>`;
                });
                html += '</div>';
            }

            if (conclusions.length === 0 && researchInterests.length === 0) {
                html = '<div class="error-message">–í—ã–≤–æ–¥—ã –∏ –Ω–∞—É—á–Ω—ã–µ –∏–Ω—Ç–µ—Ä–µ—Å—ã –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã.</div>';
            }

            document.getElementById('conclusionsContent').innerHTML = html;
        }

        function getStatusText(status) {
            const statusMap = {
                'identified': '‚úÖ –ò–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω',
                'partial_info': '‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è',
                'not_found': '‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω',
                'limited_search': 'üîç –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫',
                'educational_domain': 'üéì –û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –¥–æ–º–µ–Ω',
                'government_domain': 'üèõÔ∏è –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º–µ–Ω'
            };
            return statusMap[status] || status || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
        }

        function getSearchMethodText(method) {
            const methodMap = {
                'real_api': 'üîó API –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º',
                'alternative': 'üîÑ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫',
                'fallback': '‚ö° –†–µ–∑–µ—Ä–≤–Ω—ã–π —Ä–µ–∂–∏–º',
                'cache': 'üíæ –ö—ç—à',
                'demo': 'üé≠ –î–µ–º–æ —Ä–µ–∂–∏–º'
            };
            return methodMap[method] || method || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
        }

        function getUrlStatusText(status) {
            const statusMap = {
                'success': '‚úÖ –£—Å–ø–µ—à–Ω–æ',
                'failed': '‚ùå –ù–µ—É–¥–∞—á–Ω–æ',
                'error': '‚ö†Ô∏è –û—à–∏–±–∫–∞'
            };
            return statusMap[status] || status || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è Enter –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
        document.getElementById('emailInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchEmail();
            }
        });

        // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
        document.getElementById('emailInput').focus();

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–µ—Ç–æ–¥–æ–≤ –ø–æ–∏—Å–∫–∞
        function updateMethodDescription(method) {
            const descriptions = {
                'auto': '–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–µ—Ä–µ—Ç –ª—É—á—à–∏–π –¥–æ—Å—Ç—É–ø–Ω—ã–π –º–µ—Ç–æ–¥ –ø–æ–∏—Å–∫–∞',
                'google_api': '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Google Custom Search API –¥–ª—è –ø–æ–∏—Å–∫–∞ (–±—ã—Å—Ç—Ä–æ, —Ç–æ—á–Ω–æ)',
                'browser_search': '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ Selenium (–º–µ–¥–ª–µ–Ω–Ω–æ, –Ω–æ –æ–±—Ö–æ–¥–∏—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è)'
            };
            
            document.getElementById('methodDescription').textContent = descriptions[method] || descriptions['auto'];
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–¥–∏–æ–∫–Ω–æ–ø–æ–∫
        document.querySelectorAll('input[name="searchMethod"]').forEach(radio => {
            radio.addEventListener('change', function() {
                updateMethodDescription(this.value);
            });
        });
    </script>
</body>
</html>
